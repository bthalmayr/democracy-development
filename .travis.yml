env:
  global:
    secure: "x27uGBUltnahb6YLZBPPWe/mJHDAXRNZW8d0bgM9CFowJZE9VmcIkLvh/ZWST10TSeY0Ry1TWyGfpQwLJHuD1AmUFI06tKGR3+/wCcjOLoOX4O7oUQAcheVZ/2GCv2QdzO9zX0SQxfKXOAIIVrs6qjylTJuA3ELM1f8QdQ8qnUDiPmpjyqR4o1MDvvqda4Oennh0nZGu1HnbwkRXmSQr+BO9pKA1SZbOK5W0cqTHxX4lZbbo5UT7N6BCjSXolyKjfB5FbtXZWD8onqXuYx6kwt93vkMYmWeLqUCepvY3BDQXMMK+pTiTI0mVKTMHwgyvan9wZqORJ9g5wofoiwkS4faUcNte2+Svz/1Qk+C0JmNw55ja2SVp6E7QRaTAmuYhhHDtwLsL4ukYwYTyd6oSOS5HnRm1KJsL4ggJrHZDeKheKNVKtQcJtFov8DCh4pBqttx3VQM0KypcCT0MEzuJmbI/iggREJU7EWpIhpa1kHaEZHYHGHdg/PDgxkY2lwZXclwyFxtfcL0rCDhri4TuuYjKdF/Th6F5ReWtTo08wFPxTKq+08sMulsB7yt/+zaQ0FQ3YIlR4In9uswHgNfLK1HcIlG89J5T1OnmGg9v5uZDRWER4uwM8NzTkpvpOjGFKs+1KOCcfX/ztxGD4bJ1UYuhPzgagIDjbW8Sgar1ATU="
    secure: "msZSe8h8/Rk2QrtmxInP1+zMWujEFRQTJn1ku/HNoAzAkqju8vSbpmDB0CmWg4ASn97D7gnZCYhsVBEoLx13u69p9sJpEqsX+juBteP+UtmGJ+ivvOMRCuSWNJmQK+YngsBJygzead77o4RKC7GGTqO4prvPsgmVkkmYtesoVicBKZR4Mzs2R4Y1t2XebRLBNuylQQw2P3UEPL/zXEYz9NDW+iV49W3NbfX3HGydOzRBpw88iFNXqN1wfxCx/X02SwhNVJmELFULgkHQzhSwfBT4CBcGOiKJBu2hgf1JEcFYVsmcoFwSj5YnWlILZ+h64iFkqwTkVOspGshZY3doGv3tX+lFpHIww1RFLWUZnePsfmRi1Jn3VRRQcrkhMmRAQv4PIpg6ieT1CvilZG7E9zAKHBMS6f/qR5lTe1HV4ccnAqVE/vSsvLbEy2uMSd+bA9BiQjy6JM9avba0q9V5sJ72eWUWqXaFkvN9iYrLuelHOJKfeC8vdRHeANzQhkq90v5auXhJHG9jcpmQFbj9DNptNBNQJPwn5kuvDA3w4wvP9lbqxFJkF/tB5wk+X6THUTkz/AufpU4rPL2+rO71eqifBzxkk0gt4Hqmsio7rhayfghlYTMx8EK+rm26i92WO3z73aDoCJj0gKP5PgrEy/oGfULvGDZB0ynHtaXxYeI="
    secure: "lHYJcGXxrn7VL37pT/36m1HWBaP+CQt0dA61Zo+t9pNY4GHws1Nhn06iX5UlWTHvmFfpOmTeKZbY5ksWTSQdIdcHRnDT95Q1mp/wpEm9LL76IT2CaFoSF6lgDeX+1CLTZmuLZd2Mx5kK4nu+k6s8iqKgtSoPyNENuO5OV20LOCc3/rbiPOqb0EBvCc7iim8D9ZC+F/ertD78ylvZemYNthjflymTVXz8imSo1emdEFNYfSrlVU7nKIRZUcE2ua/RPC7PxEuPPGrNNZPJ2RqoOIR4hJECFiZmPTbXDx99tjFI1xxHJ0R7qIrbgFoObUFtN6FlahdHNUipes6zHtUUAqKDVRFxlQ+xdcPY1wGDTACCCSbg8ySL+HfKUWa2LiAEfTRi54NvVKMWPDRRGHjTlPyzE+bqYKcJgkZjzFVv1eeKkec9t+tStSG8DGrO251SbyH6fPQRYREcJyXT4iRiYIDKwtnb3g8ziWCwN8x79y5xWA+Oy/8RmhSmgTIUIoq6Q7Rg4nWXSTzjdyvSPlqvbQKuCL+Ce1yFl8IytW7BKC53fg73zJtlYVQb4oPHWkry9GZp4qS1Aj4JzFHqfm3yBJvHrJ1HyjS1S+KsM2OLFWmJL4F1MJTwiARiNDilhhi3mMr98oSDgwLPVDmtl4NObqBewkX/G0QU+oYx8dnTuh8="
    secure: "Cvczli2QXTNwU7mzsslAB4SCTj5ZiMXX14uPrazR2ggXA8KrFIpt+lQj6EQ5AVpI/nr9P1KuasQPSYGn14IWdDYOGWGwPUFWQpxsTAdv7y+C2cJlZfDmkTH38cUXoudkq+LqXfWdfMFxt5WaVmqdWfov3ENP4yHZazRaq4VjdPuzxm79WQpdXY0VYCqO0m+6cNA3bqzMquTC/pRxdOticBJraGz2Frhz78m0ZsSN3nn1fUdgEwlpeyMGgiGCP9/V/bb5iw15X1JguFf+GcKsMFufWuAPcg16BvfhTpLbKs9pmfBb1itYFKvlCVJV/jGF5ifQ48iNiy+6c9wvRoL9kDGrfDMFiV9qrI/v3zkCAu1n0xsV54iyDnnLLWUTrnVazTwMed3lbgWMyOtGDwOgs4TnxjN4MXIJCMeYefde1DO5mkES8lSCQ+hXFucjK9g3B4lrI5vEvFrTvDou2F3uNSPkA/Pjr89tlkOsH83mMk7fr+m/MkyCwabh5NNMB/qB5nud6LkiBgdWYuhWGksPgDdqXU10q2YOudzfMvs7Xq/640UAMKwsdBlpXj5N4ocnaeTMbrty1ExMlPBwHQIEIlhzALZnTq/FocRiQT+HUfNcF1I5IXAM7U+kMq9vL0cPzdOuPh4P6vxfxCrSdkFmEbf8SkfJ5HuQj44PzpifC9w="
matrix:
    include:
        -   os: linux
            before_install:
                - openssl aes-256-cbc -K $encrypted_fd73522261db_key -iv $encrypted_fd73522261db_iv -in .env.enc -out ./server/.env -d
            script:
                - docker-compose build
        -   if: tag =~ *-alpha\+server
            os: linux
            before_install:
                - openssl aes-256-cbc -K $encrypted_fd73522261db_key -iv $encrypted_fd73522261db_iv -in .env.enc -out ./server/.env -d
            script:
                - docker-compose build
                - docker build -t doctl
                - docker run --rm -e DIGITALOCEAN_ACCESS_TOKEN="${DIGITALOCEAN_ACCESS_TOKEN}" doctl ssh ${DIGITALOCEAN_ALPHA_SERVER_DROPLET_NAME} --ssh-user "${DIGITALOCEAN_ALPHA_SERVER_USER}" --ssh-command "~/democracy-development/start-production.sh"
            after_success:
                - "curl -H 'Content-Type: application/json'  -X POST -d \"{\\\"content\\\":\\\"SUCCESS: New Server Alpha Version $TRAVIS_BUILD_NUMBER available!\\\"}\" ${DISCORD_WEBHOOK}"
            after_failure:
                - "curl -H 'Content-Type: application/json'  -X POST -d \"{\\\"content\\\":\\\"FAILURE: Deploying new Server Alpha Version $TRAVIS_BUILD_NUMBER failed!\\\"}\" ${DISCORD_WEBHOOK}"
after_script:
  - echo "BUILD FINISHED"